# Оптимизация загрузки локаций

## Проблема
При заходе в раздел Users происходило множество запросов к API `/api/locations/parent/{UUID}?limit=50000` для загрузки городов. Это приводило к:
- Медленной загрузке страницы
- Избыточной нагрузке на сервер
- Плохому пользовательскому опыту

## Решение

### 1. Глобальный кэш локаций
Создан `src/shared/lib/locationCache.ts` - синглтон для кэширования локаций:
- Кэширует страны и города в памяти
- Предотвращает повторные запросы
- Предоставляет методы для загрузки всех локаций одним запросом

### 2. Оптимизированная загрузка
- **Раньше**: Множественные запросы `getCitiesByCountry()` для каждой страны
- **Теперь**: Один запрос `getCitiesByBusiness()` для загрузки всех городов

### 3. Умная загрузка
- Локации загружаются только при необходимости
- Проверка `isLoaded()` предотвращает повторную загрузку
- Кэш переиспользуется между компонентами

## Измененные файлы

### Новые файлы:
- `src/shared/lib/locationCache.ts` - глобальный кэш локаций

### Обновленные файлы:
- `src/shared/ui/UserUpsertModal.tsx` - оптимизирована загрузка локаций
- `src/app/dashboard/airline/profile/users/page.tsx` - использует глобальный кэш
- `src/app/dashboard/agent/profile/users/page.tsx` - использует глобальный кэш  
- `src/app/dashboard/agency/profile/users/page.tsx` - использует глобальный кэш

## Результат
- **Количество запросов**: Сокращено с ~50+ до 1-2 запросов
- **Время загрузки**: Значительно ускорено
- **Пользовательский опыт**: Улучшен за счет быстрой загрузки
- **Нагрузка на сервер**: Снижена

## Использование

```typescript
import { locationCache } from '@/shared/lib/locationCache';

// Загрузить все локации
await locationCache.loadAllLocations();

// Получить страну по ID
const country = locationCache.getCountry(countryId);

// Получить город по ID  
const city = locationCache.getCity(cityId);

// Проверить, загружены ли локации
const isLoaded = locationCache.isLoaded();
```
